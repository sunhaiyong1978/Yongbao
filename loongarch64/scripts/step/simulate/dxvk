source env/simulate/config
source env/distro.info
source env/function.sh
source scripts/step/simulate/dxvk.env
export STEP_BUILDNAME=simulate
export STEP_PACKAGENAME=dxvk
export PACKAGE_VERSION=git-default
export RESOURCEDIR=${NEW_TARGET_SYSDIR}/files/simulate/dxvk/git-default/
rm -rf ${BUILD_DIRECTORY}/dxvk-git-default_git
tar xvf ${DOWNLOADDIR}/dxvk-git-default_git.tar.gz -C ${BUILD_DIRECTORY} 
pushd ${BUILD_DIRECTORY}/dxvk-git-default_git
        

        mkdir cross-build
        pushd cross-build
                meson --prefix=/opt/wine-assist/dxvk-${ARCH_NAME} --buildtype=release --cross-file ${COMMON_DIR}/meson-cross-${LINUX_TAG_NAME}.txt \
		      --default-library=both \
                      ..
		ninja 
		DESTDIR=${SYSROOT_DIR} ninja install
        popd

	PATH=${CROSS_TOOLS_MINGW_PREFIX}/bin:${PATH}
        mkdir cross-build-dll
        pushd cross-build-dll
       	        meson --prefix=/opt/wine-assist/dxvk-${ARCH_NAME} --buildtype=release --cross-file ${COMMON_DIR}/meson-cross_${MINGW_TAG_NAME}.txt \
		      --default-library=both \
                      ..
		ninja 
		DESTDIR=${SYSROOT_DIR} ninja install
        popd
popd 
rm -rf ${BUILD_DIRECTORY}/dxvk-git-default_git
