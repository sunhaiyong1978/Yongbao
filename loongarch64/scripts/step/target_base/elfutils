source env/target_base/config
source env/distro.info
source env/function.sh
export STEP_BUILDNAME=target_base
export STEP_PACKAGENAME=elfutils
export PACKAGE_VERSION=git-default
export RESOURCEDIR=${NEW_TARGET_SYSDIR}/files/target_base/elfutils/git-default/
rm -rf ${BUILD_DIRECTORY}/elfutils-git-default_git
tar xvf ${DOWNLOADDIR}/elfutils-git-default_git.tar.gz -C ${BUILD_DIRECTORY} 
pushd ${BUILD_DIRECTORY}/elfutils-git-default_git
	
        for config_i in $(find -name "config.sub")
        do
                chmod 0644 $(dirname ${config_i})/config.{sub,guess}
                cp ${CROSSTOOLS_DIR}/share/automake*/config.{sub,guess} $(dirname ${config_i})/
        done
        if [ ! -f configure ]; then
                autoreconf -ifv
        fi

	sed -i.orig "s@GENDIS_ENV) \./i386_gendis@GENDIS_ENV) qemu-${ARCH_NAME} \./i386_gendis@g" libcpu/Makefile.am

	./configure ${COMMON_CONFIG} --disable-debuginfod --enable-libdebuginfod=dummy --enable-maintainer-mode \
				ac_cv_null_dereference=no
	eval ${MAKE_AND_INSTALL}

echo '#!/bin/bash -e
qemu-${ARCH_NAME} ${SYSROOT_DIR}/usr/bin/eu-readelf "$@"' > ${CROSSTOOLS_DIR}/bin/${CROSS_TARGET}-eu-readelf
chmod +x ${CROSSTOOLS_DIR}/bin/${CROSS_TARGET}-eu-readelf
popd 
rm -rf ${BUILD_DIRECTORY}/elfutils-git-default_git
