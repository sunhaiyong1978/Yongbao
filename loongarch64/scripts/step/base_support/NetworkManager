source env/base_support/config
source env/distro.info
source env/function.sh
export STEP_BUILDNAME=base_support
export STEP_PACKAGENAME=NetworkManager
export PACKAGE_VERSION=1.45.5
export RESOURCEDIR=${NEW_TARGET_SYSDIR}/files/base_support/NetworkManager/1.45.5/
rm -rf ${BUILD_DIRECTORY}/NetworkManager-1.45.5
tar xvf ${DOWNLOADDIR}/NetworkManager-1.45.5.tar.xz -C ${BUILD_DIRECTORY} 
pushd ${BUILD_DIRECTORY}/NetworkManager-1.45.5
    patch -Np1 -i ${SYSDIR}/files/base_support/NetworkManager/1.45.5/patches/0001-NetworkManager-fix-polkit-dir-error-for-cross-build.patch 
	 
    mkdir cross-build
    pushd cross-build
        meson ${MESON_CONFIG} \
	      -Dlibaudit=no -Dlibpsl=false -Dnmtui=true -Dovs=false -Dppp=false -Dselinux=false \
              -Dqt=false -Dsession_tracking=systemd -Dmodem_manager=false -Dpolkit=$((test -f ${CROSSTOOLS_DIR}/bin/rustc) && echo "true" || echo "false") \
	      -Dsystemdsystemunitdir=/usr/lib/systemd/system \
	      ..
        CC=${CROSS_TARGET}-gcc ninja
        DESTDIR=${SYSROOT_DIR} ninja install
    popd
popd 
rm -rf ${BUILD_DIRECTORY}/NetworkManager-1.45.5
