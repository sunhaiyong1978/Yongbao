source env/boot/config
source env/distro.info
source env/function.sh
export STEP_BUILDNAME=boot
export STEP_PACKAGENAME=extra-linux-kernel_git
export PACKAGE_VERSION=6.x
export RESOURCEDIR=${NEW_TARGET_SYSDIR}/files/boot/extra-linux-kernel_git/6.x/
rm -rf ${BUILD_DIRECTORY}/linux_git-6.x_git
tar xvf ${DOWNLOADDIR}/linux_git-6.x_git.tar.gz -C ${BUILD_DIRECTORY} 
pushd ${BUILD_DIRECTORY}/linux_git-6.x_git
	EXTRA_STR=$(get_user_set_env extra_str "")

	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0001-double-tty-VT-screenbuf-for-univt.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0002-Add-several-function-for-Univt.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0003-UniVT-Fix-charcount-size-to-65536.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0004-UniVT-Add-a-old_screen_size-variable-saves-the-origi.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0005-Univt-Add-support-for-writing-UTF-8-encoding.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0006-UniVT-Add-support-for-displaying-UTF-8-text.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0007-UniVT-Support-displaying-UTF-8-text-for-90-degree-ro.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0008-UniVT-Support-displaying-UTF-8-text-for-180-degree-r.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0009-UniVT-Support-displaying-UTF-8-text-for-270-degree-r.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0001-UniVT-Add-Chinese-fonts-support-in-console.patch 
	patch -Np1 -i ${SYSDIR}/files/boot/extra-linux-kernel_git/6.x/patches/0001-drm-loongson-Error-out-if-no-VRAM-detected.patch 
	 
	make mrproper
	if [ "x${EXTRA_STR}" == "x" ]; then
		cp -af ${RESOURCEDIR}/linux-config-6.x ./.config
	else
		cp -af ${RESOURCEDIR}/linux-config-6.x_${EXTRA_STR} ./.config
		sed -i "/^CONFIG_LOCALVERSION=/s@\"\"\$@\"_${EXTRA_STR}\"@g" ./.config
	fi
	make ARCH=${ARCH_FAMILY} CROSS_COMPILE=${CROSS_TARGET}- olddefconfig
	PKG_CONFIG_SYSROOT_DIR="" \
		make -j${JOBS} ARCH=${ARCH_FAMILY} CROSS_COMPILE=${CROSS_TARGET}-
	PKG_CONFIG_SYSROOT_DIR="" \
		make ARCH=${ARCH_FAMILY} CROSS_COMPILE=${CROSS_TARGET}- INSTALL_MOD_PATH=dest modules_install
	exit 1
popd 
rm -rf ${BUILD_DIRECTORY}/linux_git-6.x_git
