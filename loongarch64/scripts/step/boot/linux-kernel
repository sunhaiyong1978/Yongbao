source env/boot/config
source env/distro.info
source env/function.sh
export STEP_BUILDNAME=boot
export STEP_PACKAGENAME=linux-kernel
export PACKAGE_VERSION=6.5
export RESOURCEDIR=${NEW_TARGET_SYSDIR}/files/boot/linux-kernel/6.5/
rm -rf ${BUILD_DIRECTORY}/linux_git-6.5_git
tar xvf ${DOWNLOADDIR}/linux_git-6.5_git.tar.gz -C ${BUILD_DIRECTORY} 
pushd ${BUILD_DIRECTORY}/linux_git-6.5_git
	 
	make mrproper
	cp -af ${RESOURCEDIR}/linux-config-6 ./.config
	make ARCH=${ARCH_FAMILY} CROSS_COMPILE=${CROSS_TARGET}- olddefconfig
	PKG_CONFIG_SYSROOT_DIR="" \
		make -j${JOBS} ARCH=${ARCH_FAMILY} CROSS_COMPILE=${CROSS_TARGET}-
	PKG_CONFIG_SYSROOT_DIR="" \
		make ARCH=${ARCH_FAMILY} CROSS_COMPILE=${CROSS_TARGET}- INSTALL_MOD_PATH=dest modules_install
	mkdir -p ${SYSROOT_DIR}/lib/modules/
	cp -af dest/lib/modules/* ${SYSROOT_DIR}/lib/modules/
	cp -af arch/${ARCH_FAMILY}/boot/vmlinux.efi ${SYSROOT_DIR}/boot/vmlinux.efi
	echo "$(ls dest/lib/modules/)" > ${COMMON_DIR}/linux-kernel.version
popd 
rm -rf ${BUILD_DIRECTORY}/linux_git-6.5_git
