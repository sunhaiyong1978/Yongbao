From 240fd9d6b65308fd1fb5c01930b5a1e488f6f0be Mon Sep 17 00:00:00 2001
From: Sun Haiyong <sunhaiyong@zdbr.net>
Date: Fri, 13 Oct 2023 07:12:59 +0000
Subject: [PATCH] blender fix for python3.12

---
 .../intern/python/BPy_IntegrationType.cpp     | 12 +++----
 .../intern/python/BPy_MediumType.cpp          |  6 ++--
 .../freestyle/intern/python/BPy_MediumType.h  |  6 ++--
 .../freestyle/intern/python/BPy_Nature.cpp    | 32 +++++++++----------
 4 files changed, 28 insertions(+), 28 deletions(-)

diff --git a/source/blender/freestyle/intern/python/BPy_IntegrationType.cpp b/source/blender/freestyle/intern/python/BPy_IntegrationType.cpp
index ba2737d..40ff12d 100644
--- a/source/blender/freestyle/intern/python/BPy_IntegrationType.cpp
+++ b/source/blender/freestyle/intern/python/BPy_IntegrationType.cpp
@@ -188,13 +188,13 @@ PyTypeObject IntegrationType_Type = {
 
 /*-----------------------BPy_IntegrationType instance definitions -------------------------*/
 
-static PyLongObject _IntegrationType_MEAN = {
-    PyVarObject_HEAD_INIT(&IntegrationType_Type, 1){MEAN}};
-static PyLongObject _IntegrationType_MIN = {PyVarObject_HEAD_INIT(&IntegrationType_Type, 1){MIN}};
-static PyLongObject _IntegrationType_MAX = {PyVarObject_HEAD_INIT(&IntegrationType_Type, 1){MAX}};
-static PyLongObject _IntegrationType_FIRST = {
+static PyLongObject _IntegrationType_MEAN[] = {
+    PyVarObject_HEAD_INIT(&IntegrationType_Type, 1) {MEAN}};
+static PyLongObject _IntegrationType_MIN[] = {PyVarObject_HEAD_INIT(&IntegrationType_Type, 1){MIN}};
+static PyLongObject _IntegrationType_MAX[] = {PyVarObject_HEAD_INIT(&IntegrationType_Type, 1){MAX}};
+static PyLongObject _IntegrationType_FIRST[] = {
     PyVarObject_HEAD_INIT(&IntegrationType_Type, 1){FIRST}};
-static PyLongObject _IntegrationType_LAST = {
+static PyLongObject _IntegrationType_LAST[] = {
     PyVarObject_HEAD_INIT(&IntegrationType_Type, 1){LAST}};
 
 #define BPy_IntegrationType_MEAN ((PyObject *)&_IntegrationType_MEAN)
diff --git a/source/blender/freestyle/intern/python/BPy_MediumType.cpp b/source/blender/freestyle/intern/python/BPy_MediumType.cpp
index 61917d2..22ecce6 100644
--- a/source/blender/freestyle/intern/python/BPy_MediumType.cpp
+++ b/source/blender/freestyle/intern/python/BPy_MediumType.cpp
@@ -73,13 +73,13 @@ PyTypeObject MediumType_Type = {
 
 /*-----------------------BPy_IntegrationType instance definitions -------------------------*/
 
-PyLongObject _BPy_MediumType_DRY_MEDIUM = {
+PyLongObject _BPy_MediumType_DRY_MEDIUM[] = {
     PyVarObject_HEAD_INIT(&MediumType_Type, 1){Stroke::DRY_MEDIUM},
 };
-PyLongObject _BPy_MediumType_HUMID_MEDIUM = {
+PyLongObject _BPy_MediumType_HUMID_MEDIUM[] = {
     PyVarObject_HEAD_INIT(&MediumType_Type, 1){Stroke::HUMID_MEDIUM},
 };
-PyLongObject _BPy_MediumType_OPAQUE_MEDIUM = {
+PyLongObject _BPy_MediumType_OPAQUE_MEDIUM[] = {
     PyVarObject_HEAD_INIT(&MediumType_Type, 1){Stroke::OPAQUE_MEDIUM},
 };
 
diff --git a/source/blender/freestyle/intern/python/BPy_MediumType.h b/source/blender/freestyle/intern/python/BPy_MediumType.h
index 1bce8e7..73c11b0 100644
--- a/source/blender/freestyle/intern/python/BPy_MediumType.h
+++ b/source/blender/freestyle/intern/python/BPy_MediumType.h
@@ -34,9 +34,9 @@ typedef struct {
 int MediumType_Init(PyObject *module);
 
 // internal constants
-extern PyLongObject _BPy_MediumType_DRY_MEDIUM;
-extern PyLongObject _BPy_MediumType_HUMID_MEDIUM;
-extern PyLongObject _BPy_MediumType_OPAQUE_MEDIUM;
+extern PyLongObject _BPy_MediumType_DRY_MEDIUM[];
+extern PyLongObject _BPy_MediumType_HUMID_MEDIUM[];
+extern PyLongObject _BPy_MediumType_OPAQUE_MEDIUM[];
 // public constants
 #define BPy_MediumType_DRY_MEDIUM ((PyObject *)&_BPy_MediumType_DRY_MEDIUM)
 #define BPy_MediumType_HUMID_MEDIUM ((PyObject *)&_BPy_MediumType_HUMID_MEDIUM)
diff --git a/source/blender/freestyle/intern/python/BPy_Nature.cpp b/source/blender/freestyle/intern/python/BPy_Nature.cpp
index f218f1f..27ae1ce 100644
--- a/source/blender/freestyle/intern/python/BPy_Nature.cpp
+++ b/source/blender/freestyle/intern/python/BPy_Nature.cpp
@@ -137,27 +137,27 @@ PyTypeObject Nature_Type = {
 
 /*-----------------------BPy_Nature instance definitions ----------------------------------*/
 
-static PyLongObject _Nature_POINT = {PyVarObject_HEAD_INIT(&Nature_Type, 0){Nature::POINT}};
-static PyLongObject _Nature_S_VERTEX = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::S_VERTEX}};
-static PyLongObject _Nature_VIEW_VERTEX = {
+static PyLongObject _Nature_POINT[] = {PyVarObject_HEAD_INIT(&Nature_Type, 0){Nature::POINT}};
+static PyLongObject _Nature_S_VERTEX[] = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::S_VERTEX}};
+static PyLongObject _Nature_VIEW_VERTEX[] = {
     PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::VIEW_VERTEX}};
-static PyLongObject _Nature_NON_T_VERTEX = {
+static PyLongObject _Nature_NON_T_VERTEX[] = {
     PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::NON_T_VERTEX}};
-static PyLongObject _Nature_T_VERTEX = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::T_VERTEX}};
-static PyLongObject _Nature_CUSP = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::CUSP}};
-static PyLongObject _Nature_NO_FEATURE = {
+static PyLongObject _Nature_T_VERTEX[] = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::T_VERTEX}};
+static PyLongObject _Nature_CUSP[] = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::CUSP}};
+static PyLongObject _Nature_NO_FEATURE[] = {
     PyVarObject_HEAD_INIT(&Nature_Type, 0){Nature::NO_FEATURE}};
-static PyLongObject _Nature_SILHOUETTE = {
+static PyLongObject _Nature_SILHOUETTE[] = {
     PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::SILHOUETTE}};
-static PyLongObject _Nature_BORDER = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::BORDER}};
-static PyLongObject _Nature_CREASE = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::CREASE}};
-static PyLongObject _Nature_RIDGE = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::RIDGE}};
-static PyLongObject _Nature_VALLEY = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::VALLEY}};
-static PyLongObject _Nature_SUGGESTIVE_CONTOUR = {
+static PyLongObject _Nature_BORDER[] = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::BORDER}};
+static PyLongObject _Nature_CREASE[] = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::CREASE}};
+static PyLongObject _Nature_RIDGE[] = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::RIDGE}};
+static PyLongObject _Nature_VALLEY[] = {PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::VALLEY}};
+static PyLongObject _Nature_SUGGESTIVE_CONTOUR[] = {
     PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::SUGGESTIVE_CONTOUR}};
-static PyLongObject _Nature_MATERIAL_BOUNDARY = {
+static PyLongObject _Nature_MATERIAL_BOUNDARY[] = {
     PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::MATERIAL_BOUNDARY}};
-static PyLongObject _Nature_EDGE_MARK = {
+static PyLongObject _Nature_EDGE_MARK[] = {
     PyVarObject_HEAD_INIT(&Nature_Type, 1){Nature::EDGE_MARK}};
 
 #define BPy_Nature_POINT ((PyObject *)&_Nature_POINT)
@@ -249,7 +249,7 @@ static PyObject *BPy_Nature_bitwise(PyObject *a, int op, PyObject *b)
   else {
     result = PyObject_NewVar(BPy_Nature, &Nature_Type, 1);
     if (result) {
-      result->i.ob_digit[0] = v;
+      result->i.long_value.ob_digit[0] = v;
     }
   }
   return (PyObject *)result;
-- 
2.31.1

